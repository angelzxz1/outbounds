<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>
    <input type="file" id="fileUpload" />
    <input type="button" id="upload" value="Upload" onclick="Upload()" />
    
    <input type="text" id="cantidad">
    <input type="button" id="test" value="Seleccionar todes" onclick="selectallagents(0)"/>
    <input type="button" id="test" value="MACA TEAM" onclick="selectallagents(1)"/>
    <input type="button" id="test" value="EL IVAN TEAM" onclick="selectallagents(2)"/>
    <input type="button" id="test" value="CLAU TEAM" onclick="selectallagents(3)"/>
    <input type="button" id="test" value="SABADO MACA/IVAN" onclick="selectallagents(4)"/>
    <input type="button" id="test" value="SABADO CLAU/IVAN" onclick="selectallagents(5)"/>
    <hr/>


    <div class="border">
        <input class="agntes MACA SAB1" tiposabado="" type="checkbox" name="ALCIDES" >ALCIDES
        <input class="agntes MACA SAB1" tiposabado="" type="checkbox" name="ALEJANDRO" >ALEJANDRO
        <input class="agntes MACA SAB1" tiposabado="" type="checkbox" name="ALFREDO" >ALFREDO
        <input class="agntes IVAN SAB1" tiposabado="" type="checkbox" name="ANDREA" >ANDREA 
        <input class="agntes MACA SAB1" tiposabado="" type="checkbox" name="ANGEL" >ANGEL 
    </div>
    <div class="border">
        <input class="agntes MACA SAB1" tiposabado="" type="checkbox" name="BRAYAN" >BRAYAN 
    </div>
    <div class="border">
        <input class="agntes CLAU SAB2" tiposabado="" type="checkbox" name="CAMILA" >CAMILA
        <input class="agntes CLAU SAB2" tiposabado="" type="checkbox" name="CRISTIAN" >CRISTIAN 
    </div>
    <div class="border">
        <input class="agntes CLAU SAB2" tiposabado="" type="checkbox" name="DANIEL EIZAGA" >DANIEL EIZAGA
        <input class="agntes IVAN SAB1" tiposabado="" type="checkbox" name="DANIEL SINESTERRA" >DANIEL SINESTERRA
        <input class="agntes IVAN SAB1 SAB2" tiposabado="" type="checkbox" name="DANIELA" >DANIELA
        <input class="agntes IVAN SAB1" tiposabado="" type="checkbox" name="DARVIN" >DARVIN
        <input class="agntes IVAN SAB1" tiposabado="" type="checkbox" name="DAVID" >DAVID 
    </div>
    <div class="border">
        <input class="agntes CLAU SAB2" tiposabado="" type="checkbox" name="EMILY" >EMILY 
    </div>
    <div class="border">
        <input class="agntes CLAU SAB2" tiposabado="" type="checkbox" name="FERNANDO" >FERNANDO
        <input class="agntes CLAU SAB2" tiposabado="" type="checkbox" name="FREDDY" >FREDDY 
    </div>
    <div class="border">
        <input class="agntes CLAU SAB2" tiposabado="" type="checkbox" name="GABRIEL" >GABRIEL
        <input class="agntes CLAU SAB2" tiposabado="" type="checkbox" name="GIOVANNI HUERTAS" >GIOVANNI HUERTAS
        <input class="agntes IVAN SAB2" tiposabado="" type="checkbox" name="GIOVANNI MARQUEZ" >GIOVANNI MARQUEZ
        <input class="agntes MACA SAB1" tiposabado="" type="checkbox" name="GISELLE" >GISELLE 
    </div>
    <div class="border">
        <input class="agntes CLAU SAB2" tiposabado="" type="checkbox" name="ISAAC" >ISAAC 
    </div>
    <div class="border">
        <input class="agntes IVAN SAB1" tiposabado="" type="checkbox" name="JAVIER" >JAVIER
        <input class="agntes MACA SAB1" tiposabado="" type="checkbox" name="JOCELYN" >JOCELYN
        <input class="agntes MACA SAB1" tiposabado="" type="checkbox" name="JOHAN" >JOHAN
        <input class="agntes MACA SAB1" tiposabado="" type="checkbox" name="JORGE" >JORGE
        <input class="agntes MACA SAB1" tiposabado="" type="checkbox" name="JUAN" >JUAN
        <input class="agntes MACA SAB1" tiposabado="" type="checkbox" name="JULIO" >JULIO 
    </div>
    <div class="border">
        <input class="agntes IVAN SAB2" tiposabado="" type="checkbox" name="LESLYE" >LESLYE 
        <input class="agntes MACA SAB1" tiposabado="" type="checkbox" name="LILIAM" >LILIAM 
    </div>
    <div class="border">
        <input class="agntes IVAN SAB1" tiposabado="" type="checkbox" name="NELSON" >NELSON 
        
    </div>
    <div class="border">
        <input class="agntes IVAN SAB2" tiposabado="" type="checkbox" name="PAMELA THORN" >PAMELA 
        <input class="agntes MACA SAB1" tiposabado="" type="checkbox" name="PAULA" >PAULA THORN
    </div>
    <div class="border">
        <input class="agntes CLAU SAB2" tiposabado="" type="checkbox" name="RAME" >RAME
        <input class="agntes CLAU SAB2" tiposabado="" type="checkbox" name="ROGER" >ROGER
        <input class="agntes MACA SAB1" tiposabado="" type="checkbox" name="ROY" >ROY 
    </div>
    <div class="border">
        <input class="agntes IVAN SAB1" tiposabado="" type="checkbox" name="TITO" >TITO 
    </div>
    <div class="border">
        <input class="agntes MACA SAB1" tiposabado="" type="checkbox" name="VALENTINA" >VALENTINA
    </div>
        
        
        
        
        
    <div id="dvExcel"></div>

                            

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/xlsx.full.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/jszip.js"></script>
    <script type="text/javascript">
        var agentes = [];//LISTA DE AGENTES
        function deseleccionar() {
            var listaAgentes = document.getElementsByClassName("agntes");
            for (var i = 0; i < listaAgentes.length; i++) {
                listaAgentes[i].checked = false;
            }
        }


        function selectallagents(caso) {
            
                
            if (caso == 0) {
                var listaAgentes = document.getElementsByClassName("agntes");
                for (var i = 0; i < listaAgentes.length; i++) {
                    listaAgentes[i].checked = true;
                }
            }else if (caso == 1) {
                deseleccionar();
                var listaAgentes = document.getElementsByClassName("MACA");
                for (var i = 0; i < listaAgentes.length; i++) {
                    console.log(listaAgentes[i].checked);
                    listaAgentes[i].checked = true;
                }
            } else if (caso == 2) {
                deseleccionar();
                var listaAgentes = document.getElementsByClassName("IVAN");
                for (var i = 0; i < listaAgentes.length; i++) {
                    console.log(listaAgentes[i].checked);
                    listaAgentes[i].checked = true;
                }
            } else if (caso == 3) {
                deseleccionar();
                var listaAgentes = document.getElementsByClassName("CLAU");
                for (var i = 0; i < listaAgentes.length; i++) {
                    console.log(listaAgentes[i].checked);
                    listaAgentes[i].checked = true;
                }
            } else if (caso == 4) {
                deseleccionar();
                var listaAgentes = document.getElementsByClassName("SAB1");
                for (var i = 0; i < listaAgentes.length; i++) {
                    console.log(listaAgentes[i].checked);
                    listaAgentes[i].checked = true;
                }
            } else {
                deseleccionar();
                var listaAgentes = document.getElementsByClassName("SAB2");
                for (var i = 0; i < listaAgentes.length; i++) {
                    console.log(listaAgentes[i].checked);
                    listaAgentes[i].checked = true;
                }
            }
                
        }





        var columnas = ['C','E','F','G','H','J','L','M','N','O','P']; //vector de las columnas usadas en la lista para poder hacer el sorting
        

        function dividir(matrix) {
            
            var cuentas = matrix.length/agentes.length;
            var round = Math.floor(cuentas);
            var matrixs = [];
            var tempmtx = [];
            var limite = 0;
            var contro = 1;
            var i = 0;
            var contmatrix = 0;
            var limiteAgente = 0;
            while (i < matrix.length && limiteAgente < agentes.length) {
                if (limite < (round + 1)) {
                    if (limite == 0) {
                        tempmtx[0] = [ "Shaw Account", "Balance", "Amount Due", "PTP Status", "Buyer", "State", "Home Phone" , "Other Phone" , "Cell Phone", "DPD" , "Ext Eligibility Flag"];
                        limite++;
                    } else {
                        tempmtx[contro] = matrix[i];
                        contro++;
                        limite++;
                        i++;
                    }
                }else{
                    contro = 1;
                    limite = 0;
                    matrixs[contmatrix] = tempmtx;
                    var clear = [];
                    tempmtx = clear;
                    contmatrix++;
                    limiteAgente++;
                }
            }
            //console.log(matrixs);
            var sobrantes = [];
            var psob = round*agentes.length;
            contmatrix = 0;
            //console.log(matrix[psob]);
            for (var i = psob; i < matrix.length; i++) {
                sobrantes[contmatrix] = matrix[i];
                contmatrix++;
            }
            //console.log(sobrantes);
            for (var i = 0; i < sobrantes.length; i++) {
                var tempmax = matrixs[i];
                tempmax[tempmax.length] = sobrantes[i];

            }
            create(matrixs);/**/

        }
        function create(matrix) {

            var wb = XLSX.utils.book_new();//Crea el libro
            var ws_name = "info";//Da el nombre de la primera hoja
            var ws_data = [
                [],
                [],
                [],
                ['' , 'BUSQUEN SU NOMBRE EN LOS TABS DE ABAJO.'],
                ['' , '2 attempts']
            ];//info a asignar
            var ws = XLSX.utils.aoa_to_sheet(ws_data);//agrega los datos a la hoja
            
            XLSX.utils.book_append_sheet(wb, ws, ws_name);//agrega la hoja al libro

            for (var i = 0; i < agentes.length; i++) {
                
                
                ws_name = agentes[i];
                //ws = XLSX.utils.aoa_to_sheet(ws_data);//Agrega el dato a la hoja
                ws_data2 = matrix[i];
                ws = XLSX.utils.aoa_to_sheet(ws_data2);

                XLSX.utils.book_append_sheet(wb, ws, ws_name);//Agrega la hoja al libro

            }
                


            XLSX.writeFile(wb, 'OB DISTRO.xlsx');//crea el libro*/

            
        }




    function Upload() {
        //Reference the FileUpload element.
        var fileUpload = document.getElementById("fileUpload");
        var agentes2 = document.getElementsByClassName('agntes');
        var agnc = 0;
        for (var i = 0; i < agentes2.length; i++) {
            if (agentes2[i].checked) {
                agentes[agnc] = agentes2[i].name;
                agnc++
            } 
        }
 
        //Validate whether File is valid Excel file.
        var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.xls|.xlsx)$/;
        if (regex.test(fileUpload.value.toLowerCase())) {
            if (typeof (FileReader) != "undefined") {
                var reader = new FileReader();
 
                //For Browsers other than IE.
                if (reader.readAsBinaryString) {
                    reader.onload = function (e) {
                        //alert('Archivo de excel cargado exitosamente');
                        ProcessExcel(e.target.result);
                    };
                    reader.readAsBinaryString(fileUpload.files[0]);
                } else {
                    //For IE Browser.
                    reader.onload = function (e) {
                        var data = "";
                        var bytes = new Uint8Array(e.target.result);
                        for (var i = 0; i < bytes.byteLength; i++) {
                            data += String.fromCharCode(bytes[i]);
                        }
                        //alert('Archivo de excel cargado exitosamente');
                        ProcessExcel(data);
                    };
                    reader.readAsArrayBuffer(fileUpload.files[0]);
                }
            } else {
                alert("This browser does not support HTML5.");
            }
        } else {
            alert("Please upload a valid Excel file.");
        }
    }
    
    function ProcessExcel(data) {
        var canti = parseInt(document.getElementById('cantidad').value,10);
        //Read the Excel File data.
        var workbook = XLSX.read(data, {
            type: 'binary'
        });

        var worksheet = workbook.Sheets[workbook.SheetNames[0]];// hoja de las outbounds, esta selecciona la primera hojda dado el 0
        var fin = canti + 11;//Cantidad de clientes a llamar
        var cellMatrix = []; //matris con la lista de clientes para poder asignar los a otra lista
        var paid = false;
        var cnt = 0;//ubicador en la matris
        var orMatrx = [];
        var orMatrxA = [];
        var orMatrxB = [];

        for (var i = 0; i < canti; i++) {
            var rows = [];
            for (var j = 0; j < columnas.length; j++) {
                var posn = columnas[j]+(i+11).toString();//posicion de la columna

                rows[j] = (worksheet[posn] ? worksheet[posn].v : undefined);
            }
            orMatrx[i] = rows;
        }

        var cdma = 0;
        for (var i = 0; i < orMatrx.length; i++) {
            var rowsA = orMatrx[i];
            if (rowsA[1].toString() != '0') {
                orMatrxA[cdma] = rowsA;
                cdma++;
            }
            
        }

        //console.log(orMatrxA);


        var cdmb = 0;
        for (var i = 0; i < orMatrxA.length; i++) {
            var rowsB = orMatrxA[i];
            if (rowsB[3] == undefined) {
                orMatrxB[cdmb] = rowsB;
                cdmb++;
            }else if (rowsB[3].toString() != 'O') {
                orMatrxB[cdmb] = rowsB;
                cdmb++;
            }
            
        }
        //console.log(orMatrxB);
        dividir(orMatrxB);
    }

</script>

</body>
</html>

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    