<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>
    <div class="col">
        
    
        <input class="btn border" type="file" id="fileUpload" />
        <input class="btn border" type="button" id="showlist" value="Cargar" onclick="Upload()" />
        <input class="btn border" type="button" id="createlist" value="Crear" onclick="ProcessExcel()" disabled="true"/>
        <div id="cntcuentas" style="display: inline-block; padding-left: 15px;">cantidad de cuentas: </div>
        <br><br>
        <input type="button" id="test" class="btn btn-primary" value="Seleccionar todes" onclick="selectallagents(0)"/>
        <input type="button" id="test" class="btn btn-success" value="MACA TEAM" onclick="selectallagents(1)"/>
        <input type="button" id="test" class="btn btn-success" value="CLAU TEAM" onclick="selectallagents(2)"/>
        <input type="button" id="test" class="btn btn-info" value="SABADO MACA" onclick="selectallagents(3)"/>
        <input type="button" id="test" class="btn btn-info" value="SABADO CLAU" onclick="selectallagents(4)"/>
        <hr/>
    </div>
    <button data-toggle="collapse" data-target="#agentes" class="btn btn-primary ml-5 ">MOSTRAR/OCULTAR AGENTES</button>
    <div class="col collapse" id="agentes">
        <div class="row border p-2">
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="ALBERTO" >ALBERTO</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="ALCIDES" >ALCIDES</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="ALEJANDRO" >ALEJANDRO</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB1" type="checkbox" name="ALFREDO" >ALFREDO</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="ANDREA" >ANDREA </div>
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="ANGEL" >ANGEL </div>
        </div>
        <div class="row border p-2">
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="BRAYAN" >BRAYAN</div>
        </div>
        <div class="row border p-2">
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB2" type="checkbox" name="CAMILA" >CAMILA</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB2" type="checkbox" name="CRISTIAN" >CRISTIAN</div>
        </div>
        <div class="row border p-2">
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB2" type="checkbox" name="DANIEL EIZAGA" >DANIEL EIZAGA</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB1 SAB2" type="checkbox" name="DANIEL SINESTERRA" >DANIEL SINESTERRA</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB1 SAB2" type="checkbox" name="DANIELA" >DANIELA</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB1" type="checkbox" name="DARVIN" >DARVIN</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB1" type="checkbox" name="DAVID" >DAVID</div>
        </div>
        <div class="row border p-2">
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB1 SAB2" type="checkbox" name="EMILY" >EMILY</div>
        </div>
        <div class="row border p-2">
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB2" type="checkbox" name="FERNANDO" >FERNANDO</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB2" type="checkbox" name="FREDDY" >FREDDY</div>
        </div>
        <div class="row border p-2">
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB1 SAB2" type="checkbox" name="GABRIEL" >GABRIEL</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB2" type="checkbox" name="GIOVANNI HUERTAS" >GIOVANNI H</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB2" type="checkbox" name="GIOVANNI MARQUEZ" >GIOVANNI M</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="GISELLE" >GISELLE</div>
        </div>
        <div class="row border p-2">
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB2" type="checkbox" name="ISAAC" >ISAAC</div>
        </div>
        <div class="row border p-2">
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB1" type="checkbox" name="JAVIER" >JAVIER</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="JESUS" >JESUS</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="JOCELYN" >JOCELYN</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="JOHAN" >JOHAN</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="JORGE" >JORGE</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="JUAN" >JUAN</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="JULIO" >JULIO</div>
        </div>
        <div class="row border p-2">
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB2" type="checkbox" name="LESLYE" >LESLYE</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="LILIAM" >LILIAM</div>
        </div>
        <div class="row border p-2">
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB2" type="checkbox" name="PAMELA THORN" >PAMELA</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="PAULA" >PAULA THORN</div>
        </div>
        <div class="row border p-2">
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB2" type="checkbox" name="RAME" >RAME</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes CLAU SAB2" type="checkbox" name="ROGER" >ROGER</div>
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="ROY" >ROY</div>
        </div>
        <div class="row border p-2">
            <div class="col-2" style="display: inline-block;"><input class="agntes MARIA SAB1" type="checkbox" name="TITO" >TITO</div>
        </div>
        <div class="row border p-2">
            <div class="col-2" style="display: inline-block;"><input class="agntes MACA SAB1" type="checkbox" name="VALENTINA" >VALENTINA</div>
        </div>
    </div>
    <button data-toggle="collapse" data-target="#lista" class="btn btn-primary ml-5 ">MOSTRAR/OCULTAR LISTA</button>
    <div id="lista"></div>
                            

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/xlsx.full.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/jszip.js"></script>
    
    <script type="text/javascript">
        var gwb;
        var columnas = []; //vector de las columnas usadas en la lista para poder hacer el sorting
        //Shaw Account    Balance   Amount Due    PTP Status  Name Key  State   Home Phone     Other Phone    Cell Phone  DPD    Ext Eligibility Flag  
        var colstouse;
        var columnas2 = ['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];
        var colselected = [];
        var gobalData;
        var agentes = [];//LISTA DE AGENTES
        
        function Upload() {
            //Reference the FileUpload element.
            var fileUpload = document.getElementById("fileUpload");
            var agentes2 = document.getElementsByClassName('agntes');
            var agnc = 0;
            for (var i = 0; i < agentes2.length; i++) {
                if (agentes2[i].checked) {
                    agentes[agnc] = agentes2[i].name;
                    agnc++
                } 
            }
     
            //Validate whether File is valid Excel file.
            var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.xls|.xlsx)$/;
            if (regex.test(fileUpload.value.toLowerCase())) {
                if (typeof (FileReader) != "undefined") {
                    var reader = new FileReader();
     
                    //For Browsers other than IE.
                    if (reader.readAsBinaryString) {
                        reader.onload = function (e) {
                            //alert('Archivo de excel cargado exitosamente');
                            agregarlista(e.target.result);
                            //ProcessExcel(e.target.result);
                            
                        };
                        reader.readAsBinaryString(fileUpload.files[0]);
                    } else {
                        //For IE Browser.
                        reader.onload = function (e) {
                            var data = "";
                            var bytes = new Uint8Array(e.target.result);
                            for (var i = 0; i < bytes.byteLength; i++) {
                                data += String.fromCharCode(bytes[i]);
                            }
                            agregarlista(data);
                            //ProcessExcel(data);
                            
                        };
                        reader.readAsArrayBuffer(fileUpload.files[0]);
                    }
                } else {
                    alert("This browser does not support HTML5.");
                }
            } else {
                alert("Please upload a valid Excel file.");
            }
        }

        function agregarlista(data) {
            gobalData = data;
            
            //Read the Excel File data.
            var workbook = XLSX.read(data, {
                type: 'binary'
            });

            var worksheet = workbook.Sheets[workbook.SheetNames[0]];
            document.getElementById("cntcuentas").innerHTML += (worksheet['B4'] ? worksheet['B4'].v : undefined);
            var rows = [];
            var j = 0;
            var count = 0;
            var infodatos = [];//////////////////
            while (j < columnas2.length) {
                var posn = columnas2[j]+(10).toString();//posicion de la columna
                var dato = (worksheet[posn] ? worksheet[posn].v : undefined);
                //console.log(dato);
                if (dato != undefined) {
                    rows[count] = "<div><input type='checkbox' class='colstouse' checked='true' name='"+columnas2[j]+dato+"'>"+dato+"</div>"
                    count++;
                }
                j++
            }
            for (var i = 0; i < rows.length; i++) {
                document.getElementById("lista").innerHTML += rows[i]
            }
            document.getElementById("createlist").disabled = false;
            
        }
        function ProcessExcel() {
            var data = gobalData;
            //Read the Excel File data.
            var workbook = XLSX.read(data, {
                type: 'binary'
            });

            var worksheet = workbook.Sheets[workbook.SheetNames[0]];// hoja de las outbounds, esta selecciona la primera hojda dado el 0
            var fin = worksheet['B4'].toString() + 11;//Cantidad de clientes a llamar
            var cellMatrix = []; //matris con la lista de clientes para poder asignar los a otra lista
            var paid = false;
            var cnt = 0;//ubicador en la matris
            var orMatrx = [];
            var orMatrxA = [];
            var orMatrxB = [];
            var orMatrxC = [];

            for (var i = 0; i < worksheet['B4'].toString(); i++) {
                
                var rows = [];
                for (var j = 0; j < columnas.length; j++) {
                    var posn = columnas[j]+(i+11).toString();//posicion de la columna

                    rows[j] = (worksheet[posn] ? worksheet[posn].v : undefined);
                }
                orMatrx[i] = rows;
            }

            var cdma = 0;
            for (var i = 0; i < orMatrx.length; i++) {
                var rowsA = orMatrx[i];
                if (rowsA[1].toString() != '0') {
                    orMatrxA[cdma] = rowsA;
                    cdma++;
                }
                
            }
            var cdmb = 0;
            for (var i = 0; i < orMatrxA.length; i++) {
                var rowsB = orMatrxA[i];
                if (rowsB[3] == undefined) {
                    orMatrxB[cdmb] = rowsB;
                    cdmb++;
                }else if (rowsB[3].toString() != 'O') {
                    orMatrxB[cdmb] = rowsB;
                    cdmb++;
                }
                
            }
            
            for (var i = 0; i < orMatrxB.length; i++) {

                var rowsC = orMatrxB[i];
                var accnbr = rowsC[0];
                var acccl = accnbr.substring(9, 16);
                orMatrxB[i][0] = acccl;
            }
            colstouse = document.getElementsByClassName("colstouse");
            getCols(colstouse);
            dividir(orMatrxB);
        }
        
        function getCols(cols) {
            var colcont = 0;    
            for (var i = 0; i < cols.length; i++) {
                if (cols[i].checked) {
                    columnas[colcont] = cols[i].name.substring(0,1);
                    colselected[colcont] = cols[i].name.substring(1);
                    colcont++;
                }
            }
            //console.log(columnas);
            //console.log(colselected);
            
        }
        function dividir(matrix) {
            
            var cuentas = matrix.length/agentes.length;
            var round = Math.floor(cuentas);
            var matrixs = [];
            var tempmtx = [];
            var limite = 0;
            var contro = 1;
            var i = 0;
            var contmatrix = 0;
            var limiteAgente = 0;
            while (i < matrix.length && limiteAgente < agentes.length) {
                if (limite < (round + 1)) {
                    if (limite == 0) {
                        tempmtx[0] = colselected;
                        limite++;
                    } else {
                        tempmtx[contro] = matrix[i];
                        contro++;
                        limite++;
                        i++;
                    }
                }else{
                    contro = 1;
                    limite = 0;
                    matrixs[contmatrix] = tempmtx;
                    var clear = [];
                    tempmtx = clear;
                    contmatrix++;
                    limiteAgente++;
                }
            }
            //console.log(matrixs);
            var sobrantes = [];
            var psob = round*agentes.length;
            contmatrix = 0;
            //console.log(matrix[psob]);
            for (var i = psob; i < matrix.length; i++) {
                sobrantes[contmatrix] = matrix[i];
                contmatrix++;
            }
            //console.log(sobrantes);
            for (var i = 0; i < sobrantes.length; i++) {
                var tempmax = matrixs[i];
                tempmax[tempmax.length] = sobrantes[i];

            }
            create(matrixs);/**/

        }
        function create(matrix) {

            var wb = XLSX.utils.book_new();//Crea el libro
            var ws_name = "info";//Da el nombre de la primera hoja
            var ws_data = [
                [],
                [],
                [],
                ['' , 'BUSQUEN SU NOMBRE EN LOS TABS DE ABAJO.'],
                ['' , '2 attempts']
            ];//info a asignar
            var ws = XLSX.utils.aoa_to_sheet(ws_data);//agrega los datos a la hoja
            
            XLSX.utils.book_append_sheet(wb, ws, ws_name);//agrega la hoja al libro

            for (var i = 0; i < agentes.length; i++) {
                ws_name = agentes[i];
                //ws = XLSX.utils.aoa_to_sheet(ws_data);//Agrega el dato a la hoja
                ws_data2 = matrix[i];
                ws = XLSX.utils.aoa_to_sheet(ws_data2);
                XLSX.utils.book_append_sheet(wb, ws, ws_name);//Agrega la hoja al libro
            }
            gwb = wb;
            crearlibro()

        }
        function crearlibro() {
            XLSX.writeFile(gwb, 'OB DISTRO.xlsx');//crea el libro*/
        }









        
        

        

        
        function deseleccionar() {
            var listaAgentes = document.getElementsByClassName("agntes");
            for (var i = 0; i < listaAgentes.length; i++) {
                listaAgentes[i].checked = false;
            }
        }


        function selectallagents(caso) {
            
                
            if (caso == 0) {
                var listaAgentes = document.getElementsByClassName("agntes");
                for (var i = 0; i < listaAgentes.length; i++) {
                    listaAgentes[i].checked = true;
                }
            }else if (caso == 1) {
                deseleccionar();
                var listaAgentes = document.getElementsByClassName("MACA");
                for (var i = 0; i < listaAgentes.length; i++) {
                    console.log(listaAgentes[i].checked);
                    listaAgentes[i].checked = true;
                }
            } else if (caso == 2) {
                deseleccionar();
                var listaAgentes = document.getElementsByClassName("CLAU");
                for (var i = 0; i < listaAgentes.length; i++) {
                    console.log(listaAgentes[i].checked);
                    listaAgentes[i].checked = true;
                }
            } else if (caso == 3) {
                deseleccionar();
                var listaAgentes = document.getElementsByClassName("SAB1");
                for (var i = 0; i < listaAgentes.length; i++) {
                    console.log(listaAgentes[i].checked);
                    listaAgentes[i].checked = true;
                }
            } else {
                deseleccionar();
                var listaAgentes = document.getElementsByClassName("SAB2");
                for (var i = 0; i < listaAgentes.length; i++) {
                    console.log(listaAgentes[i].checked);
                    listaAgentes[i].checked = true;
                }
            } 
                
        }





        


        


        




    
    
        

</script>

</body>
</html>

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    